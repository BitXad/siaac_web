<?php
/* 
 * Generated by CRUDigniter v3.2 
 * www.crudigniter.com
 */
 
class Citacion_model extends CI_Model{
    
    function __construct()
    {
        parent::__construct();
    }
    /*
    * Obtener todas las citaciones de un docente 
    */
    function get_citaciones($docente_id){
        $citaciones = $this->db->query(
            "SELECT c.*, e.`estudiante_nombre`,e.`estudiante_apellidos`, es.`estado_descripcion`
            FROM citacion as c 
            LEFT JOIN estudiante as e on c.`estudiante_id` = e.estudiante_id
            LEFT JOIN estado as es on c.`estado_id` = es.`estado_id`
            WHERE c.`docente_id` = $docente_id
        ")->result_array();
        return $citaciones;
    }

    /*
    * Estados de citacion 
    */
    function get_estado(){
        $estados = $this->db->query(
            "SELECT * 
            FROM estado
            WHERE estado_tipo = 1
            ")->result_array();
        return $estados;
    }

    /*
    * Obtener citacion 
    */
    function get_citacion($citacion_id){
        $citacion = $this->db->query(
            "SELECT *
            FROM citacion
            where citacion_id = $citacion_id"
        )->row_array();
        return $citacion;
    }

    /*
    * Agregar citacion 
    */
    function add_citacion($params){
        $this->db->insert('citacion',$params);
        return $this->db->insert_id();
    }

    /*
    * Actualizar citacion 
    */
    function update_citacion($citacion_id, $params){
        $this->db->where('citacion_id',$citacion_id);
        return $this->db->update('citacion',$params);
    }

    /*
    *   Cantidad total de citaciones de estudiante 
    */
    function get_citaciones_estudiante($estudiante_id){
        $total =$this->db->query(
            "select if(COUNT(c.`citacion_id`)>0,COUNT(c.`citacion_id`),0) as total_citaciones
            from citacion as c 
            where c.`estado_id` = 1
            and c.`estudiante_id` = $estudiante_id"
        )->row_array();
    }

    /*
    * Obtener todas las citaciones de un estudiante 
    */
    function get_all_citaciones($estudiante_id){
        return $this->db->query(
            "SELECT c.*, m.`materia_nombre`, d.`docente_nombre`, d.`docente_apellidos`
            FROM citacion as c
            LEFT JOIN docente AS d ON c.`docente_id` = d.`docente_id`
            LEFT JOIN materia AS m ON c.`materia_id` = m.`materia_id`
            WHERE c.`estudiante_id` = $estudiante_id
            ORDER BY c.`citacion_fecha` DESC"
        )->result_array();
    }
    /* 
    * Obtener citacion 
    */
    function get_citacion_estudiante($citacion_id){
        return $this->db->query(
            "SELECT c.*, m.`materia_nombre`, d.`docente_nombre`, d.`docente_apellidos`
            FROM citacion AS c
            LEFT JOIN docente AS d ON c.`docente_id` = d.`docente_id`
            LEFT JOIN materia AS m ON c.`materia_id` = m.`materia_id`
            WHERE c.`citacion_id` = 1
            "
        )->row_array();
    }
    /* 
    *  Obtener el total de Citaciones de un estudiante
    */
    function total_citaciones($estudiante_id){
        $fecha_actual = date("Y-m-d");
        $total_citacion = $this->db->query(
            "SELECT IF(COUNT(c.`citacion_titulo`)>0,COUNT(c.`citacion_titulo`),0) as total_citaciones
            FROM citacion as c
            WHERE '$fecha_actual' <= c.`citacion_fecha`
            AND c.`estudiante_id` = $estudiante_id 
            ")->row_array();
        return $total_citacion;
    }
}